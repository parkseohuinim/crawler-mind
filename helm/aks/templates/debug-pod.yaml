# 네트워크 연결 테스트용 디버그 파드
apiVersion: v1
kind: Pod
metadata:
  name: debug-network
  labels:
    app: debug
spec:
  containers:
    - name: debug
      image: curlimages/curl:latest
      command: ["/bin/sh"]
      args: ["-c", "while true; do sleep 3600; done"]
      env:
        - name: SERVICES_TO_TEST
          value: "postgres:5432,mcp-server:4200,opensearch:9200,qdrant:6333"
  restartPolicy: Always
---
# 네트워크 연결 테스트 스크립트
apiVersion: v1
kind: ConfigMap
metadata:
  name: network-test-script
data:
  test-connections.sh: |
    #!/bin/sh
    echo "🔍 Testing internal network connections..."
    
    # PostgreSQL 테스트
    echo "Testing PostgreSQL..."
    if nc -z postgres 5432; then
        echo "✅ PostgreSQL (postgres:5432) - CONNECTED"
    else
        echo "❌ PostgreSQL (postgres:5432) - FAILED"
    fi
    
    # MCP Server 테스트  
    echo "Testing MCP Server..."
    if curl -f --max-time 5 http://mcp-server:4200 >/dev/null 2>&1; then
        echo "✅ MCP Server (mcp-server:4200) - CONNECTED"
    else
        echo "❌ MCP Server (mcp-server:4200) - FAILED"
    fi
    
    # OpenSearch 테스트
    echo "Testing OpenSearch..."
    if curl -f --max-time 5 http://opensearch:9200 >/dev/null 2>&1; then
        echo "✅ OpenSearch (opensearch:9200) - CONNECTED"
    else
        echo "❌ OpenSearch (opensearch:9200) - FAILED"
    fi
    
    # Qdrant 테스트
    echo "Testing Qdrant..."
    if curl -f --max-time 5 http://qdrant:6333 >/dev/null 2>&1; then
        echo "✅ Qdrant (qdrant:6333) - CONNECTED"
    else
        echo "❌ Qdrant (qdrant:6333) - FAILED"
    fi
    
    echo "🔍 DNS Resolution Test..."
    nslookup postgres
    nslookup mcp-server  
    nslookup opensearch
    nslookup qdrant
