# ë„¤íŠ¸ì›Œí¬ ì—°ê²° í…ŒìŠ¤íŠ¸ìš© ë””ë²„ê·¸ íŒŒë“œ
apiVersion: v1
kind: Pod
metadata:
  name: debug-network
  labels:
    app: debug
spec:
  containers:
    - name: debug
      image: curlimages/curl:latest
      command: ["/bin/sh"]
      args: ["-c", "while true; do sleep 3600; done"]
      env:
        - name: SERVICES_TO_TEST
          value: "postgres:5432,mcp-server:4200,opensearch:9200,qdrant:6333"
  restartPolicy: Always
---
# ë„¤íŠ¸ì›Œí¬ ì—°ê²° í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸
apiVersion: v1
kind: ConfigMap
metadata:
  name: network-test-script
data:
  test-connections.sh: |
    #!/bin/sh
    echo "ğŸ” Testing internal network connections..."
    
    # PostgreSQL í…ŒìŠ¤íŠ¸
    echo "Testing PostgreSQL..."
    if nc -z postgres 5432; then
        echo "âœ… PostgreSQL (postgres:5432) - CONNECTED"
    else
        echo "âŒ PostgreSQL (postgres:5432) - FAILED"
    fi
    
    # MCP Server í…ŒìŠ¤íŠ¸  
    echo "Testing MCP Server..."
    if curl -f --max-time 5 http://mcp-server:4200 >/dev/null 2>&1; then
        echo "âœ… MCP Server (mcp-server:4200) - CONNECTED"
    else
        echo "âŒ MCP Server (mcp-server:4200) - FAILED"
    fi
    
    # OpenSearch í…ŒìŠ¤íŠ¸
    echo "Testing OpenSearch..."
    if curl -f --max-time 5 http://opensearch:9200 >/dev/null 2>&1; then
        echo "âœ… OpenSearch (opensearch:9200) - CONNECTED"
    else
        echo "âŒ OpenSearch (opensearch:9200) - FAILED"
    fi
    
    # Qdrant í…ŒìŠ¤íŠ¸
    echo "Testing Qdrant..."
    if curl -f --max-time 5 http://qdrant:6333 >/dev/null 2>&1; then
        echo "âœ… Qdrant (qdrant:6333) - CONNECTED"
    else
        echo "âŒ Qdrant (qdrant:6333) - FAILED"
    fi
    
    echo "ğŸ” DNS Resolution Test..."
    nslookup postgres
    nslookup mcp-server  
    nslookup opensearch
    nslookup qdrant
