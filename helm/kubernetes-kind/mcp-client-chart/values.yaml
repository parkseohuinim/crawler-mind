replicaCount: 1

image:
  repository: seohuipark/crawler-mind-mcp-client
  tag: dev
  pullPolicy: Always

env:
  MCP_SERVER_URL: "http://mcp-server:4200/my-custom-path/"  # ëì˜ / ì œê±°
  CORS_ORIGINS: "[\"https://crawler.alvinpark.xyz\",\"https://api.alvinpark.xyz\",\"http://localhost:3000\"]"  # API ì„œë¸Œë„ë©”ì¸ ì¶”ê°€
  OPENAI_MODEL: "gpt-4o"
  OPENAI_API_KEY: "YOUR_OPENAI_API_KEY_HERE"

  DATABASE_URL: "postgresql+asyncpg://admin:YOUR_PASSWORD@postgres:5432/crawler_mind"

  # PostgreSQL
  # POSTGRES_USER: "admin"
  # POSTGRES_PASSWORD: "199084"
  # POSTGRES_HOST: "postgres"
  # POSTGRES_PORT: "5432"
  # POSTGRES_DB: "crawler_mind"
  # POSTGRES_POOL_SIZE: "10"
  # POSTGRES_MAX_OVERFLOW: "20"
  # POSTGRES_POOL_TIMEOUT: "30"
  # POSTGRES_POOL_RECYCLE: "3600"  # 1ì‹œê°„ë§ˆë‹¤ ì—°ê²° ì¬ìƒì„±
  # POSTGRES_POOL_PRE_PING: "true"  # ì—°ê²° ìƒíƒœ í™•ì¸

  # OpenSearch - HOSTì™€ PORT ë‘˜ ë‹¤ í•„ìš”
  OPENSEARCH_HOST: "https://opensearch.alvinpark.xyz"
  OPENSEARCH_PORT: "9200"               # í¬íŠ¸ ë³„ë„ ì§€ì •

  # Qdrant - HOSTì™€ PORT ë‘˜ ë‹¤ í•„ìš”
  QDRANT_HOST: "https://qdrant.alvinpark.xyz"  # ì™¸ë¶€ ë„ë©”ì¸ ë˜ëŠ” "http://qdrant:6333" (ë‚´ë¶€ ì„œë¹„ìŠ¤)
  QDRANT_PORT: "6333"                   # í¬íŠ¸ ë³„ë„ ì§€ì •

  # ë©”ëª¨ë¦¬ ìµœì í™” ì„¤ì •
  PYTHONUNBUFFERED: "1"
  PYTHONDONTWRITEBYTECODE: "1"
  
  # ë²¡í„° DB ì²˜ë¦¬ ìµœì í™” ì„¤ì • (ì„±ëŠ¥ê³¼ ì•ˆì •ì„±ì˜ ê· í˜•)
  MAX_WORKERS: "2"                    # ì„ë² ë”© ìƒì„± ì›Œì»¤ ìˆ˜ ì ì ˆíˆ ì¦ê°€
  EMBEDDING_BATCH_SIZE: "8"           # ì„ë² ë”© ë°°ì¹˜ í¬ê¸° ì ì ˆíˆ ì¦ê°€ (3GB ë©”ëª¨ë¦¬ ê³ ë ¤)
  QDRANT_BATCH_SIZE: "15"             # Qdrant ë°°ì¹˜ í¬ê¸° ì ì ˆíˆ ì¦ê°€ (3GB ë©”ëª¨ë¦¬ ê³ ë ¤)
  CHUNK_SIZE: "1000"                  # í…ìŠ¤íŠ¸ ì²­í‚¹ í¬ê¸° ì ì ˆíˆ ì¦ê°€ (3GB ë©”ëª¨ë¦¬ ê³ ë ¤)
  CHUNK_OVERLAP: "50"                 # ì²­í¬ ì˜¤ë²„ë© ì ì ˆíˆ ì¦ê°€ (3GB ë©”ëª¨ë¦¬ ê³ ë ¤)
  
  # ë©”ëª¨ë¦¬ ê´€ë¦¬ ì„¤ì • (3GB ë©”ëª¨ë¦¬ì— ìµœì í™”)
  ENABLE_MEMORY_CLEANUP: "true"       # ë°°ì¹˜ ì²˜ë¦¬ í›„ ë©”ëª¨ë¦¬ ì •ë¦¬ í™œì„±í™”
  GC_THRESHOLD: "50"                  # ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ ì„ê³„ê°’ ì ì ˆíˆ ì„¤ì •
  MAX_DOCUMENTS_IN_MEMORY: "30"       # ë©”ëª¨ë¦¬ì— ë™ì‹œ ë³´ê´€í•  ìµœëŒ€ ë¬¸ì„œ ìˆ˜ ì ì ˆíˆ ì¦ê°€
  
  # íŒŒì¼ ì—…ë¡œë“œ ê´€ë ¨ ì„¤ì •
  MAX_FILE_SIZE: "500MB"
  UPLOAD_TIMEOUT: "3600"

# ì¶”ê°€ì ì¸ ì•ˆì •ì„± ì„¤ì •
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000

# ëŒ€ìš©ëŸ‰ íŒŒì¼ ì²˜ë¦¬ë¥¼ ìœ„í•œ ì¶”ê°€ ì„¤ì •
nodeSelector: {}
tolerations: []
affinity: {}

# HPA ì„¤ì • (ì„ íƒì‚¬í•­ - í•„ìš”ì‹œ í™œì„±í™”)
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 3
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

resources:
  requests:
    cpu: 250m
    memory: 1Gi
  limits:
    cpu: 1000m
    memory: 3Gi  # ì„±ëŠ¥ê³¼ ì•ˆì •ì„±ì˜ ê· í˜• (7.4GB ì¤‘ 3GB, ì—¬ìœ ìˆê²Œ)

# ë©”ëª¨ë¦¬ ì••ë°• ì‹œ íŒŒë“œ ìŠ¤ì¼€ì¤„ë§ ì •ì±…
tolerations:
- key: "memory-pressure"
  operator: "Exists"
  effect: "NoSchedule"

# ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§ì„ ìœ„í•œ ì„¤ì •
monitoring:
  enabled: true
  memoryThreshold: "80%"  # ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥  80% ì´ìƒ ì‹œ ì•Œë¦¼

service:
  type: ClusterIP
  port: 8000

ingress:
  enabled: true
  className: nginx
  annotations:
    # íŒŒì¼ ì—…ë¡œë“œ í¬ê¸° ì œí•œì„ 500MBë¡œ ì„¤ì • (ëŒ€ìš©ëŸ‰ RAG ë°ì´í„° ì²˜ë¦¬)
    nginx.ingress.kubernetes.io/client-max-body-size: "500m"
    # ì—…ë¡œë“œ íƒ€ì„ì•„ì›ƒì„ 60ë¶„ìœ¼ë¡œ ì„¤ì • (ëŒ€ìš©ëŸ‰ íŒŒì¼ ì²˜ë¦¬ ì‹œê°„ ê³ ë ¤)
    nginx.ingress.kubernetes.io/proxy-read-timeout: "3600"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "3600"
    # ì—°ê²° ìœ ì§€ ì‹œê°„ì„ 60ë¶„ìœ¼ë¡œ ì„¤ì •
    nginx.ingress.kubernetes.io/proxy-connect-timeout: "3600"
  hosts:
    - host: api.alvinpark.xyz  # ğŸ”¥ API ì„œë¸Œë„ë©”ì¸ìœ¼ë¡œ ë³€ê²½
      paths:
        - path: /
          pathType: Prefix
  tls: [] # Cloudflare Tunnel ì“¸ ë•ŒëŠ” ì—¬ê¸° ë¹„ì›Œë‘¬ë„ ë¨
